<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recollect — Retro Assistant</title>
  <style>
    /* Local font faces */
    @font-face {
      font-family: 'PressStart2P';
      src: local('Press Start 2P'), url('PressStart2P-Regular.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
    }
    @font-face {
      font-family: 'Inconsolata';
      src: local('Inconsolata'), url('Inconsolata-Regular.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    :root{--bg:#0b0e13; --panel:#0f1720; --accent:#39ff14; --muted:#8da3b9; --shadow: rgba(0,0,0,0.6);}
    html,body{height:100%;margin:0;font-family:Inconsolata, monospace;background:linear-gradient(180deg,#061018,var(--bg));color:var(--muted);display:flex;align-items:stretch;justify-content:center;padding:24px;}
    .frame{width:1080px;max-width:96vw;height:78vh;background:var(--panel);border-radius:12px;box-shadow:0 12px 40px var(--shadow);border:4px solid #071722;overflow:hidden;display:grid;grid-template-columns:360px 1fr;grid-template-rows:64px 1fr;}
    header{grid-column:1/-1;display:flex;align-items:center;gap:12px;padding:12px 18px;border-bottom:1px solid rgba(255,255,255,0.02);}
    .logo{font-family:'PressStart2P', monospace;color:var(--accent);font-size:18px;letter-spacing:1px}
    header .subtitle{font-size:11px;color:var(--muted);margin-left:6px}
    .sidebar{padding:18px;border-right:1px solid rgba(255,255,255,0.02);display:flex;flex-direction:column;gap:12px}
    label{font-size:11px;color:var(--muted);}
    input[type="text"]{background:transparent;border:1px dashed rgba(255,255,255,0.03);padding:10px;color:var(--muted);border-radius:6px;width:100%;box-sizing:border-box}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:10px 12px;border-radius:8px;color:var(--muted);cursor:pointer;font-family:inherit}
    .btn:hover{box-shadow:0 6px 16px rgba(0,0,0,0.45);}
    .btn.primary{border-color:var(--accent);color:var(--accent);}
    .main{padding:18px;display:flex;flex-direction:column;gap:12px}
    .searchbar{display:flex;gap:8px;align-items:center}
    .search-input{flex:1;background:transparent;border:1px dashed rgba(255,255,255,0.03);padding:10px;color:var(--muted);border-radius:6px}
    .results{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border-radius:8px;padding:12px;overflow:auto}
    .result{padding:10px;border-radius:6px;margin-bottom:8px}
    .filename{font-family:'PressStart2P', monospace;color:var(--accent);font-size:12px}
    .excerpt{font-size:12px;color:var(--muted);margin-top:6px}
    .console{height:110px;border-radius:8px;padding:10px;font-size:12px;background:linear-gradient(180deg, rgba(0,0,0,0.2), rgba(255,255,255,0.01));overflow:auto}
    .log{font-family:Inconsolata;color:var(--muted);}
    .log.success{color:var(--accent)}
    .log.error{color:#ff6b6b}
    footer{grid-column:1/-1;padding:8px 12px;font-size:11px;color:rgba(255,255,255,0.12);border-top:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:center}
  </style>
</head>
<body>
  <div class="frame">
    <header>
      <div class="logo">RECOLLECT</div>
      <div class="subtitle">retro assistant — local, private, fast</div>
      <div style="margin-left:auto; font-size:12px; color:var(--muted);">Status: <span id="status">Idle</span></div>
    </header>

    <aside class="sidebar">
      <div>
        <label class="small">Directory Path</label>
        <input id="dirPath" type="text" placeholder="/home/user/my-data" />
      </div>
      <div>
        <button class="btn primary" id="setPathBtn">Set Directory</button>
      </div>
    </aside>

    <main class="main">
      <div class="searchbar">
        <input id="searchInput" class="search-input" type="search" placeholder="Search your recollections..." />
        <button class="btn primary" id="searchBtn">Search</button>
      </div>
      <div class="results" id="results" role="region" aria-live="polite">
        <div style="font-size:12px; color:var(--muted);">No results yet.</div>
      </div>
      <div class="console" id="console"></div>
    </main>

    <footer>
      <div>Local-only mode supported</div>
      <div style="font-family:'PressStart2P', monospace; color:var(--accent); font-size:10px">v0.9 RETRO</div>
    </footer>
  </div>

  <script>
    const setPathBtn = document.getElementById('setPathBtn');
    const searchBtn = document.getElementById('searchBtn');
    const searchInput = document.getElementById('searchInput');
    const results = document.getElementById('results');
    const consoleEl = document.getElementById('console');
    const dirPath = document.getElementById('dirPath');
    const statusEl = document.getElementById('status');

    const setPathEndpoint = '/api/set-path';
    const searchEndpoint = '/api/search';

    function log(text, type='info'){
      const el = document.createElement('div'); el.className = 'log ' + (type==='success'?'success':type==='error'?'error':'');
      el.textContent = `[${new Date().toLocaleTimeString()}] ${text}`;
      consoleEl.prepend(el);
    }

    function setStatus(text){ statusEl.textContent = text; }

    async function setDirectory(path){
      setStatus('Setting path...');
      try{
        const resp = await fetch(setPathEndpoint, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ path })
        });
        if(!resp.ok) throw new Error('Failed to set path');
        log(`Directory set: ${path}`,'success');
        setStatus('Idle');
      }catch(e){ log(e.message,'error'); setStatus('Error'); }
    }

    async function search(q){
      if(!q) { log('Please enter search terms','error'); return; }
      setStatus('Searching');
      try{
        const resp = await fetch(searchEndpoint, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ q })
        });
        if(!resp.ok) throw new Error('Search failed');
        const data = await resp.json();
        renderResults(data.results || []);
        log(`Search returned ${ (data.results||[]).length } results`,'success');
        setStatus('Idle');
      }catch(e){ log(e.message,'error'); setStatus('Error'); }
    }

    function renderResults(items){
      results.innerHTML='';
      if(!items.length){ results.innerHTML='<div style="color:var(--muted);">No results</div>'; return; }
      items.forEach(it=>{
        const r = document.createElement('div'); r.className='result';
        r.innerHTML = `<div class="filename">${escapeHtml(it.path || 'unknown')}</div>
                       <div class="excerpt">${escapeHtml(it.excerpt || '').slice(0,500)}</div>`;
        results.appendChild(r);
      });
    }

    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    setPathBtn.addEventListener('click', ()=>{ setDirectory(dirPath.value.trim()); });
    searchBtn.addEventListener('click', ()=>{ search(searchInput.value.trim()); });
    searchInput.addEventListener('keydown', e=>{ if(e.key==='Enter') searchBtn.click(); });

    log('Welcome to Recollect. Set directory path and start searching.');
  </script>
</body>
</html>
